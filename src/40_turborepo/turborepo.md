# Turborepo ä»é›¶å¼€å§‹å­¦ä¹ æŒ‡å—

## ğŸ“š ç›®å½•
1. [ç”¨å¤§ç™½è¯è¯´ï¼šTurborepo æ˜¯å•¥](#ç”¨å¤§ç™½è¯è¯´turborepo-æ˜¯å•¥)
2. [å®‰è£…ä¸ç¬¬ä¸€æ¬¡è¿è¡Œ](#å®‰è£…ä¸ç¬¬ä¸€æ¬¡è¿è¡Œ)
3. [æ ¸å¿ƒåŸåˆ™ï¼šä»»åŠ¡åœ¨ã€Œå„ä¸ªåŒ…ã€é‡Œï¼Œæ ¹ç›®å½•åªã€Œå‘å·æ–½ä»¤ã€](#æ ¸å¿ƒåŸåˆ™ä»»åŠ¡åœ¨å„ä¸ªåŒ…é‡Œæ ¹ç›®å½•åªå‘å·æ–½ä»¤)
4. [turbo.json è¯¦è§£ï¼šæ¯ä¸ªå­—æ®µåœ¨å¹²ä»€ä¹ˆ](#turbojson-è¯¦è§£æ¯ä¸ªå­—æ®µåœ¨å¹²ä»€ä¹ˆ)
5. [dependsOn è¯¦è§£ï¼šè°å…ˆè·‘ã€è°åè·‘](#dependson-è¯¦è§£è°å…ˆè·‘è°åè·‘)
6. [è¿è¡Œå‘½ä»¤ä¸è¿‡æ»¤ï¼šåªè·‘æˆ‘æƒ³è·‘çš„é‚£éƒ¨åˆ†](#è¿è¡Œå‘½ä»¤ä¸è¿‡æ»¤åªè·‘æˆ‘æƒ³è·‘çš„é‚£éƒ¨åˆ†)
7. [ç¼“å­˜ä¸ç¯å¢ƒå˜é‡ï¼šä¸ºä»€ä¹ˆæ”¹äº†ä»£ç è¿˜æ˜¯ç”¨æ—§ç»“æœ](#ç¼“å­˜ä¸ç¯å¢ƒå˜é‡ä¸ºä»€ä¹ˆæ”¹äº†ä»£ç è¿˜æ˜¯ç”¨æ—§ç»“æœ)
8. [CI/CD ä¸å¼€å‘æ—¶çš„ watch](#cicd-ä¸å¼€å‘æ—¶çš„-watch)
9. [å¸¸è§å‘ä¸æ­£ç¡®å†™æ³•](#å¸¸è§å‘ä¸æ­£ç¡®å†™æ³•)
10. [ä¸€ä¸ªå®Œæ•´ç¤ºä¾‹ï¼šä»é›¶æ­ä¸€ä¸ªå° monorepo](#ä¸€ä¸ªå®Œæ•´ç¤ºä¾‹ä»é›¶æ­ä¸€ä¸ªå°-monorepo)
11. [æœ€ä½³å®è·µä¸å‚è€ƒ](#æœ€ä½³å®è·µä¸å‚è€ƒ)

---

## ç”¨å¤§ç™½è¯è¯´ï¼šTurborepo æ˜¯å•¥

### ä½ é‡åˆ°çš„é—®é¢˜ï¼ˆæ²¡æœ‰ Turbo æ—¶ï¼‰

åœ¨ä¸€ä¸ª **monorepo**ï¼ˆä¸€ä¸ªä»“åº“é‡Œå¤šä¸ªåº”ç”¨å’Œå¤šä¸ªå…¬å…±åŒ…ï¼‰é‡Œï¼Œä½ å¯èƒ½ä¼šè¿™æ ·å¹²æ´»ï¼š

- æƒ³ã€Œå…¨ä»“åº“ build ä¸€éã€ï¼šè‡ªå·±å†™ `cd apps/web && pnpm build && cd ../api && pnpm build && ...`ï¼Œé¡ºåºå®¹æ˜“å†™é”™ï¼Œä¹Ÿæ²¡æ³•å¹¶è¡Œã€‚
- æƒ³ã€Œåª build æ”¹è¿‡çš„åŒ…ã€ï¼šä¸çŸ¥é“è°ä¾èµ–è°ï¼Œåªèƒ½å…¨é‡ buildï¼Œå¾ˆæ…¢ã€‚
- ç¬¬äºŒæ¬¡ buildï¼šæ˜æ˜æ²¡æ”¹ä»£ç ï¼Œåˆè¦é‡æ–°ç¼–è¯‘ä¸€éï¼Œå› ä¸ºæ²¡æœ‰ä¸€ä¸ªã€Œä¸Šæ¬¡ç»“æœèƒ½ä¸èƒ½ç›´æ¥ç”¨ã€çš„æœºåˆ¶ã€‚

ä¹Ÿå°±æ˜¯è¯´ï¼š**è°å…ˆæ‰§è¡Œã€è°å¯ä»¥ä¸€èµ·æ‰§è¡Œã€ä¸Šæ¬¡çš„ç»“æœèƒ½ä¸èƒ½å¤ç”¨**ï¼Œéƒ½è¦ä½ è‡ªå·±ç®¡ï¼Œå¾ˆç´¯ã€‚

### Turborepo å¸®ä½ åšå•¥

Turborepo æ˜¯ä¸€ä¸ª **ã€Œä»»åŠ¡è°ƒåº¦ + ç¼“å­˜ã€** çš„å·¥å…·ï¼Œä¸“é—¨ç»™ **JavaScript/TypeScript çš„ monorepo** ç”¨ï¼š

1. **æŒ‰ä¾èµ–å…³ç³»æ’é¡ºåº**  
   æ¯”å¦‚ï¼š`apps/web` ä¾èµ– `packages/ui`ï¼Œé‚£å®ƒä¼š**å…ˆ** build `packages/ui`ï¼Œ**å†** build `apps/web`ï¼Œä½ ä¸ç”¨æ‰‹å†™ `cd` å’Œ `&&`ã€‚

2. **èƒ½å¹¶è¡Œçš„å°±ä¸€èµ·è·‘**  
   æ¯”å¦‚ï¼š`apps/web` å’Œ `apps/api` äº’ä¸ä¾èµ–ï¼Œå®ƒå°±**åŒæ—¶**è·‘ä¸¤è¾¹çš„ buildï¼Œè€Œä¸æ˜¯ä¸€ä¸ªè·‘å®Œå†è·‘å¦ä¸€ä¸ªã€‚

3. **è®°ä¸‹æ¯æ¬¡ build çš„ã€Œè¾“å…¥ã€å’Œã€Œè¾“å‡ºã€**  
   ä¸‹æ¬¡å¦‚æœè¾“å…¥ï¼ˆä»£ç ã€ç¯å¢ƒå˜é‡ç­‰ï¼‰æ²¡å˜ï¼Œå°±ç›´æ¥ç”¨ä¸Šæ¬¡çš„äº§ç‰©ï¼Œä¸å†é‡æ–°è·‘ï¼Œè¿™å°±æ˜¯**ç¼“å­˜**ã€‚æœ¬åœ°å’Œ CI éƒ½å¯ä»¥ç”¨ï¼Œç”šè‡³èƒ½å…±äº«è¿œç¨‹ç¼“å­˜ã€‚

4. **åªè·‘ã€Œå—å½±å“ã€çš„åŒ…**  
   é…åˆ Git å¯ä»¥åªå¯¹ã€Œæœ‰æ”¹åŠ¨çš„åŒ…ã€è·‘ build/testï¼Œçœæ—¶é—´ã€‚

ä¸€å¥è¯ï¼š**Turborepo ä¸æ›¿ä»£ä½ çš„ build/lint/test å‘½ä»¤ï¼Œè€Œæ˜¯å¸®ä½ ã€Œåœ¨æ­£ç¡®çš„é¡ºåºä¸‹ã€å¹¶è¡Œåœ°ã€å¸¦ç¼“å­˜åœ°ã€æ‰§è¡Œè¿™äº›å‘½ä»¤ã€‚**

### é€‚åˆè°ç”¨ï¼Ÿ

- ä»“åº“é‡Œ**ä¸æ­¢ä¸€ä¸ªåº”ç”¨**ï¼ˆæ¯”å¦‚æœ‰ `web`ã€`admin`ã€`api`ï¼‰ã€‚
- æœ‰**å…¬å…±åŒ…**è¢«å¤šä¸ªåº”ç”¨å¼•ç”¨ï¼ˆæ¯”å¦‚ `packages/ui`ã€`packages/utils`ï¼‰ã€‚
- ç”¨ **pnpm / Yarn / npm** çš„ workspace ç®¡ç†å¤šåŒ…ã€‚

æ»¡è¶³è¿™äº›ï¼Œå°±é€‚åˆä¸Š Turborepoã€‚å•åº”ç”¨ã€å•åŒ…é¡¹ç›®ä¸€èˆ¬ç”¨ä¸ä¸Šã€‚

---

## å®‰è£…ä¸ç¬¬ä¸€æ¬¡è¿è¡Œ

### åœ¨å·²æœ‰ monorepo é‡Œå®‰è£…

åœ¨**ä»“åº“æ ¹ç›®å½•**æ‰§è¡Œï¼ˆä»»é€‰ä¸€ç§åŒ…ç®¡ç†å™¨ï¼‰ï¼š

```bash
pnpm add -D turbo
# æˆ–
npm i -D turbo
# æˆ–
yarn add -D turbo
```

è£…å¥½åï¼Œæ ¹ç›®å½•çš„ `package.json` é‡Œä¼šæœ‰ `turbo` è¿™ä¸ª dev ä¾èµ–ã€‚

### ç¬¬ä¸€æ¬¡è¿è¡Œå‰è¦å‡†å¤‡å•¥ï¼Ÿ

1. **æ ¹ç›®å½•**æœ‰ä¸€ä¸ª `turbo.json`ï¼Œé‡Œé¢å†™ä¸Šä½ è¦è·‘çš„ä»»åŠ¡ï¼ˆæ¯”å¦‚ `build`ã€`lint`ï¼‰ã€‚
2. **å„ä¸ªå­åŒ…**çš„ `package.json` é‡Œè¦æœ‰åŒåçš„è„šæœ¬ï¼ˆæ¯”å¦‚éƒ½æœ‰ `"build": "xxx"`ï¼‰ã€‚
3. æ ¹ç›®å½•çš„ `package.json` é‡Œç”¨ `turbo run build` è¿™ç§å½¢å¼**è°ƒç”¨**ï¼Œè€Œä¸æ˜¯è‡ªå·±å†™ `cd xxx && pnpm build`ã€‚

ä¸‹é¢å‡ èŠ‚ä¼šä¸€æ­¥æ­¥è¯´æ¸…æ¥šæ€ä¹ˆé…ã€‚

### ç”¨è„šæ‰‹æ¶ä»é›¶ç”Ÿæˆï¼ˆå¯é€‰ï¼‰

å¦‚æœè¿˜æ²¡æœ‰ monorepo ç»“æ„ï¼Œå¯ä»¥ç”¨å®˜æ–¹è„šæ‰‹æ¶ç”Ÿæˆä¸€ä¸ªç¤ºä¾‹ï¼š

```bash
npx create-turbo@latest
```

ä¼šé—®ä½ é¡¹ç›®åã€åŒ…ç®¡ç†å™¨ç­‰ï¼Œç„¶åç”Ÿæˆç±»ä¼¼è¿™æ ·çš„ç»“æ„ï¼š

```
my-turbo/
â”œâ”€â”€ apps/
â”‚   â”œâ”€â”€ web/          # ä¸€ä¸ª Next åº”ç”¨
â”‚   â””â”€â”€ docs/         # ä¸€ä¸ªæ–‡æ¡£ç«™
â”œâ”€â”€ packages/
â”‚   â”œâ”€â”€ ui/           # å…¬å…±ç»„ä»¶
â”‚   â””â”€â”€ eslint-config/
â”œâ”€â”€ package.json      # æ ¹ package.json
â”œâ”€â”€ pnpm-workspace.yaml  # æˆ– package.json çš„ workspaces
â””â”€â”€ turbo.json       # Turbo é…ç½®
```

ä½ å¯ä»¥åœ¨è¿™ä¸ªåŸºç¡€ä¸Šåˆ æ”¹ï¼Œç†è§£ã€Œä»»åŠ¡åœ¨åŒ…é‡Œã€æ ¹åªè´Ÿè´£ turbo runã€çš„ç”¨æ³•ã€‚

### æ ¹ package.json å»ºè®®é•¿ä»€ä¹ˆæ ·ï¼Ÿ

æ ¹ç›®å½•çš„ `package.json` **åªè´Ÿè´£è½¬å‘**ç»™ Turboï¼Œä¸å†™å…·ä½“ build é€»è¾‘ï¼š

```json
{
  "name": "my-monorepo",
  "private": true,
  "scripts": {
    "build": "turbo run build",
    "lint": "turbo run lint",
    "test": "turbo run test",
    "dev": "turbo run dev"
  },
  "devDependencies": {
    "turbo": "latest"
  }
}
```

ä»¥åä½ åœ¨æ ¹ç›®å½•æ‰§è¡Œ `pnpm build`ï¼Œå®é™…å°±æ˜¯æ‰§è¡Œ `turbo run build`ï¼Œç”± Turbo å»å„ä¸ªåŒ…é‡Œæ‰¾ `build` è„šæœ¬å¹¶æŒ‰ä¾èµ–é¡ºåºã€å¹¶è¡Œã€å¸¦ç¼“å­˜åœ°è·‘ã€‚

**ä¸€ä¸ªå°ç»†èŠ‚**ï¼šè„šæœ¬é‡Œè¯·å†™ **`turbo run build`**ï¼Œä¸è¦å†™ **`turbo build`**ã€‚  
`turbo build` æ˜¯ç®€å†™ï¼Œåªåœ¨**ä½ è‡ªå·±åœ¨ç»ˆç«¯é‡Œæ•²**çš„æ—¶å€™ç”¨ï¼›å†™åœ¨ `package.json` æˆ– CI è„šæœ¬é‡Œæ—¶ï¼Œç»Ÿä¸€ç”¨ `turbo run build`ï¼Œè¿™æ ·æ›´æ¸…æ™°ã€ä¹Ÿä¸å®¹æ˜“å’Œä»¥åç‰ˆæœ¬è¡Œä¸ºä¸ä¸€è‡´ã€‚

---

## æ ¸å¿ƒåŸåˆ™ï¼šä»»åŠ¡åœ¨ã€Œå„ä¸ªåŒ…ã€é‡Œï¼Œæ ¹ç›®å½•åªã€Œå‘å·æ–½ä»¤ã€

è¿™æ˜¯ Turborepo æœ€å®¹æ˜“æé”™çš„ä¸€ç‚¹ï¼Œå¤šèŠ±ä¸¤åˆ†é’Ÿç†è§£ï¼Œåé¢ä¼šå°‘è¸©å¾ˆå¤šå‘ã€‚

### ä¸‰å¥è¯è®°ä½

1. **çœŸæ­£çš„å‘½ä»¤**ï¼ˆæ¯”å¦‚ `next build`ã€`tsc`ã€`eslint .`ï¼‰å†™åœ¨**æ¯ä¸ªå­åŒ…**çš„ `package.json` çš„ `scripts` é‡Œã€‚
2. **æ ¹ç›®å½•**çš„ `turbo.json` åªè´Ÿè´£å£°æ˜ï¼šè¿™äº›ä»»åŠ¡å«å•¥åå­—ã€è°å…ˆè°åã€äº§å‡ºæ”¾å“ªã€è¦ä¸è¦ç¼“å­˜ã€‚
3. **æ ¹ç›®å½•**çš„ `package.json` çš„ `scripts` é‡Œåªå†™ `turbo run build`ã€`turbo run lint` è¿™ç§ã€Œå‘å·æ–½ä»¤ã€ï¼Œä¸å†™å…·ä½“ `cd` å’Œå…·ä½“å·¥å…·å‘½ä»¤ã€‚

å¯ä»¥ç±»æ¯”ï¼š  
- å„åŒ…çš„ `package.json` = æ¯ä¸ªå°ç»„è‡ªå·±çš„ã€Œåšäº‹æ¸…å•ã€  
- `turbo.json` = æ€»è°ƒåº¦è¡¨ï¼ˆè°å…ˆåšã€è°å¯ä»¥ä¸€èµ·åšã€ç»“æœå­˜å“ªï¼‰  
- æ ¹çš„ `package.json` = ä½ åªè¯´ã€Œå¼€å§‹ buildã€ã€Œå¼€å§‹ lintã€ï¼Œå…·ä½“è°åšã€æ€ä¹ˆåšäº¤ç»™ Turboã€‚

### æ­£ç¡®å†™æ³•ç¤ºä¾‹

**1. æ¯ä¸ªåŒ…æœ‰è‡ªå·±çš„è„šæœ¬ï¼ˆçœŸæ­£å¹²æ´»çš„å‘½ä»¤ï¼‰**

```json
// apps/web/package.json â€”â€” å‰ç«¯åº”ç”¨
{
  "name": "@repo/web",
  "scripts": {
    "build": "next build",
    "lint": "eslint .",
    "test": "vitest run"
  }
}

// apps/api/package.json â€”â€” åç«¯æ¥å£
{
  "name": "@repo/api",
  "scripts": {
    "build": "tsc",
    "lint": "eslint .",
    "test": "vitest run"
  }
}

// packages/ui/package.json â€”â€” å…¬å…±ç»„ä»¶åº“
{
  "name": "@repo/ui",
  "scripts": {
    "build": "tsc",
    "lint": "eslint .",
    "test": "vitest run"
  }
}
```

**2. æ ¹ç›®å½• turbo.jsonï¼šåªå†™ã€Œè§„åˆ™ã€ï¼Œä¸å†™å…·ä½“å‘½ä»¤**

```json
{
  "$schema": "https://turborepo.dev/schema.v2.json",
  "tasks": {
    "build": {
      "dependsOn": ["^build"],
      "outputs": [".next/**", "dist/**"]
    },
    "lint": {},
    "test": {
      "dependsOn": ["build"]
    }
  }
}
```

è¿™é‡Œçš„æ„æ€æ˜¯ï¼š  
- å« `build` çš„ä»»åŠ¡ï¼šå…ˆè·‘ä¾èµ–åŒ…çš„ buildï¼ˆ`^build`ï¼‰ï¼Œäº§å‡ºåœ¨ `.next/**` æˆ– `dist/**`ã€‚  
- å« `lint` çš„ä»»åŠ¡ï¼šæ²¡æœ‰é¡ºåºè¦æ±‚ï¼Œå„åŒ…è‡ªå·±è·‘å°±è¡Œã€‚  
- å« `test` çš„ä»»åŠ¡ï¼šæœ¬åŒ…å…ˆè·‘å®Œ `build` å†è·‘ `test`ã€‚

**3. æ ¹ package.jsonï¼šåªè½¬å‘**

```json
{
  "scripts": {
    "build": "turbo run build",
    "lint": "turbo run lint",
    "test": "turbo run test"
  }
}
```

è¿™æ ·ä½ åœ¨æ ¹ç›®å½•æ‰§è¡Œ `pnpm build`ï¼ŒTurbo ä¼šå»æ‰€æœ‰æœ‰ `build` è„šæœ¬çš„åŒ…é‡Œï¼ŒæŒ‰ä¾èµ–å…³ç³»å…ˆè·‘ä¾èµ–åŒ…å†è·‘åº”ç”¨ï¼Œèƒ½å¹¶è¡Œçš„ä¼šå¹¶è¡Œï¼Œè¿˜èƒ½ç”¨ç¼“å­˜ã€‚

### é”™è¯¯å†™æ³•ï¼ˆå°½é‡é¿å…ï¼‰

| é”™è¯¯å†™æ³• | é—®é¢˜ | æ­£ç¡®åšæ³• |
|----------|------|----------|
| æ ¹ç›®å½•å†™ `"build": "cd apps/web && next build && cd ../api && tsc"` | å®Œå…¨ç»•è¿‡ Turboï¼Œæ²¡æœ‰å¹¶è¡Œã€æ²¡æœ‰ç¼“å­˜ã€é¡ºåºä¹Ÿéš¾ç»´æŠ¤ | å„åŒ…å†™è‡ªå·±çš„ `build`ï¼Œæ ¹åªå†™ `turbo run build` |
| æ ¹ç›®å½•å†™ `"build": "next build"` | åª build äº†æ ¹ç›®å½•ï¼ˆæ ¹é€šå¸¸ä¸æ˜¯åº”ç”¨ï¼‰ï¼Œè€Œä¸”æ²¡ç”¨åˆ° Turbo | æ ¹åªå†™ `turbo run build`ï¼Œè®© Turbo å»å„åŒ…æ‰§è¡Œ |
| åœ¨ `apps/web` é‡Œå†™ `"prebuild": "cd ../../packages/ui && pnpm run build"` | é¡ºåºç¡¬ç¼–ç ã€å®¹æ˜“é”™ã€Turbo ä¸çŸ¥é“ä¾èµ–å…³ç³» | åœ¨ `apps/web` çš„ dependencies é‡Œå£°æ˜ `@repo/ui`ï¼Œåœ¨ turbo.json é‡Œç”¨ `dependsOn: ["^build"]` |

---

## turbo.json è¯¦è§£ï¼šæ¯ä¸ªå­—æ®µåœ¨å¹²ä»€ä¹ˆ

`turbo.json` æ”¾åœ¨**ä»“åº“æ ¹ç›®å½•**ï¼Œé‡Œé¢æ˜¯ä¸€ä¸ª `tasks` å¯¹è±¡ï¼škey æ˜¯ä»»åŠ¡åï¼ˆå’Œå„ä¸ªåŒ…é‡Œçš„ `scripts` åå­—å¯¹åº”ï¼‰ï¼Œvalue æ˜¯è¿™ä¸ªä»»åŠ¡åœ¨ã€Œå…¨ä»“åº“ã€ä¸‹çš„ç»Ÿä¸€è§„åˆ™ã€‚

### æœ€ç®€ç¤ºä¾‹

```json
{
  "$schema": "https://turborepo.dev/schema.v2.json",
  "tasks": {
    "build": {
      "dependsOn": ["^build"],
      "outputs": ["dist/**"]
    },
    "lint": {},
    "dev": {
      "cache": false,
      "persistent": true
    }
  }
}
```

- `$schema`ï¼šæ–¹ä¾¿ç¼–è¾‘å™¨æç¤ºå’Œæ ¡éªŒï¼Œå»ºè®®ä¿ç•™ã€‚  
- `tasks.build`ï¼šè¡¨ç¤ºã€Œæ‰€æœ‰åŒ…é‡Œçš„ `build` è„šæœ¬ã€éƒ½éµå®ˆè¿™ä¸¤æ¡è§„åˆ™ï¼šå…ˆè·‘ä¾èµ–åŒ…çš„ buildï¼Œäº§å‡ºåœ¨ `dist/**`ã€‚  
- `tasks.lint`ï¼šæ²¡æœ‰é¢å¤–è§„åˆ™ï¼Œå„åŒ…ç›´æ¥è·‘è‡ªå·±çš„ `lint`ã€‚  
- `tasks.dev`ï¼šä¸ç¼“å­˜ï¼ˆæ¯æ¬¡éƒ½æ˜¯å®æ—¶è·‘ï¼‰ï¼Œè€Œä¸”æ˜¯å¸¸é©»ä»»åŠ¡ï¼ˆä¸ç»“æŸï¼‰ï¼Œé€‚åˆæœ¬åœ°å¼€å‘æœåŠ¡å™¨ã€‚

ä¸‹é¢é€ä¸ªè¯´å¸¸ç”¨å­—æ®µã€‚

### dependsOnï¼šè°å…ˆè·‘ã€è°åè·‘

- **ä¸å†™**ï¼šè¿™ä¸ªä»»åŠ¡æ²¡æœ‰é¡ºåºè¦æ±‚ï¼ŒTurbo ä¼šå¹¶è¡Œè·‘æ‰€æœ‰åŒ…çš„è¿™ä¸€ä»»åŠ¡ï¼ˆåœ¨ä¾èµ–å…è®¸çš„èŒƒå›´å†…ï¼‰ã€‚  
- **`["^build"]`**ï¼šå…ˆè·‘**æˆ‘ä¾èµ–çš„é‚£äº›åŒ…**çš„ `build`ï¼Œå†è·‘æˆ‘çš„ `build`ã€‚  
  - ã€Œæˆ‘ä¾èµ–çš„åŒ…ã€æ¥è‡ªå„åŒ… `package.json` é‡Œçš„ `dependencies` / `devDependencies`ï¼ˆworkspace åŒ…ï¼‰ã€‚  
- **`["build"]`**ï¼šå…ˆè·‘**æœ¬åŒ…**çš„ `build`ï¼Œå†è·‘å½“å‰ä»»åŠ¡ï¼ˆæ¯”å¦‚å…ˆ build å† testï¼‰ã€‚  
- **`["web#build"]`**ï¼šå…ˆè·‘**åä¸º web çš„åŒ…**çš„ `build`ï¼Œå†è·‘å½“å‰ä»»åŠ¡ï¼ˆç”¨äºæ ¹ä»»åŠ¡æˆ–ç‰¹æ®Šç¼–æ’ï¼‰ã€‚

**ä¸€å¥è¯ä¾‹å­**ï¼šæ¯”å¦‚ Aã€Bã€C ä¸‰ä¸ªå­æ¨¡å—ï¼ŒB æ˜¯å·¥å…·åŒ…ï¼Œåœ¨ A å’Œ C é‡Œéƒ½ç”¨åˆ°äº†ï¼ˆAã€C çš„ package.json é‡Œå£°æ˜äº†ä¾èµ– Bï¼‰ã€‚é…ç½®äº† `dependsOn: ["^build"]` åï¼š**å…ˆè·‘ B çš„ build**ï¼Œç­‰ B è·‘å®Œå†è·‘ **A å’Œ C çš„ build**ï¼›A å’Œ C äº’ä¸ä¾èµ–ï¼Œæ‰€ä»¥ä¼š**å¹¶è¡Œ**è·‘ã€‚é¡ºåºå°±æ˜¯ï¼šå…ˆ B â†’ å† Aã€C ä¸€èµ·ã€‚

**å¸¸è§ç»„åˆ**ï¼š

- æ„å»ºï¼š`"dependsOn": ["^build"]` â†’ ä¾èµ–åŒ…å…ˆ buildï¼Œå† build å½“å‰åŒ…ã€‚  
- æµ‹è¯•ï¼š`"dependsOn": ["build"]` â†’ æœ¬åŒ…å…ˆ buildï¼ˆäº§å‡ºå¯èƒ½è¢« test ç”¨ï¼‰ï¼Œå† testã€‚  
- ä»… lintï¼š`"dependsOn": []` æˆ–ä¸å†™ â†’ å„åŒ…å¹¶è¡Œ lintã€‚

ä¸‹ä¸€èŠ‚ä¼šç”¨ä¸€ä¸ªä¾èµ–å…³ç³»å›¾æ¥åŠ æ·±ç†è§£ã€‚

### outputsï¼šä»»åŠ¡äº§å‡ºçš„ç›®å½•ï¼ˆå’Œç¼“å­˜æœ‰å…³ï¼‰

Turbo ä¼šæŠŠä½ **ç¬¬ä¸€æ¬¡è·‘**æŸä¸ªä»»åŠ¡çš„ã€Œè¾“å‡ºç›®å½•ã€æ‰“æˆç¼“å­˜ï¼›ä¹‹åå¦‚æœè¾“å…¥æ²¡å˜ï¼Œå°±ç›´æ¥è§£å‹è¿™äº›ç›®å½•ï¼Œ**ä¸å†é‡æ–°æ‰§è¡Œ**è¿™ä¸ªä»»åŠ¡ã€‚  
å¦‚æœä½ ä¸å‘Šè¯‰å®ƒã€Œäº§å‡ºåœ¨å“ªã€ï¼Œå®ƒå°±ä¸ä¼šæ­£ç¡®æ¢å¤äº§ç‰©ï¼Œå¯èƒ½å‡ºç°ã€Œæ˜æ˜å‘½ä¸­ç¼“å­˜å´çœ‹ä¸åˆ° distã€çš„æƒ…å†µã€‚

æ‰€ä»¥ï¼š**åªè¦è¿™ä¸ªä»»åŠ¡ä¼šå¾€ç£ç›˜å†™ä¸œè¥¿ï¼ˆæ¯”å¦‚ build å†™å‡º distã€test å†™å‡º coverageï¼‰ï¼Œå°±åº”è¯¥åœ¨ `outputs` é‡Œå†™ä¸Šè¿™äº›è·¯å¾„ã€‚**

ç¤ºä¾‹ï¼š

```json
"build": {
  "dependsOn": ["^build"],
  "outputs": ["dist/**", ".next/**", "!.next/cache/**"]
}
```

- `dist/**`ï¼šé€‚åˆ tscã€Viteã€Rollup ç­‰ã€‚  
- `.next/**`ï¼šNext.jsï¼›`!.next/cache/**` è¡¨ç¤ºæ’é™¤ cacheï¼Œé¿å…æŠŠå¤§ç¼“å­˜ä¹Ÿæ‰“è¿› turbo ç¼“å­˜ã€‚  
- è‹¥æŸåŒ… test ä¼šç”Ÿæˆ `coverage/`ï¼Œå¯ä»¥ç»™è¯¥ä»»åŠ¡çš„ `outputs` åŠ  `["coverage/**"]`ï¼ˆä¹Ÿå¯ä»¥æ”¾åˆ°åŒ…çº§ turbo é…ç½®é‡Œï¼‰ã€‚

**ä¸å†™ `outputs`**ï¼šTurbo ä»å¯èƒ½ç®—ç¼“å­˜å“ˆå¸Œå¹¶æ˜¾ç¤ºã€Œç¼“å­˜å‘½ä¸­ã€ï¼Œä½†ä¸ä¼šæ¢å¤ä»»ä½•æ–‡ä»¶ï¼Œä»»åŠ¡å¯èƒ½è¯¯ç”¨ã€Œä¸Šæ¬¡çš„æ—§äº§ç‰©ã€æˆ–æ‰¾ä¸åˆ°äº§å‡ºã€‚

### inputsï¼šå“ªäº›æ–‡ä»¶/ç›®å½•å‚ä¸ã€Œç®—ç¼“å­˜ã€

é»˜è®¤æƒ…å†µä¸‹ï¼ŒTurbo ä¼šç”¨ã€Œé¡¹ç›®é‡Œå¤§éƒ¨åˆ†æºç  + é…ç½®ã€æ¥ç®—ä¸€ä¸ªå“ˆå¸Œï¼›å“ˆå¸Œä¸€æ ·å°±è®¤ä¸ºè¾“å…¥æ²¡å˜ï¼Œç”¨ç¼“å­˜ã€‚  
å¦‚æœä½ æœ‰ä¸€äº›**é¢å¤–**ä¼šå½±å“ç»“æœçš„æ–‡ä»¶ï¼ˆæ¯”å¦‚ `.env`ã€æŸä¸ª `config.json`ï¼‰ï¼Œéœ€è¦è®© Turbo çŸ¥é“ï¼Œå¦åˆ™æ”¹äº†ä»–ä»¬ç¼“å­˜ä¹Ÿä¸ä¼šå¤±æ•ˆã€‚

å†™æ³•ç¤ºä¾‹ï¼š

```json
"build": {
  "dependsOn": ["^build"],
  "outputs": ["dist/**"],
  "inputs": ["$TURBO_DEFAULT$", ".env", ".env.*"]
}
```

- `$TURBO_DEFAULT$` è¡¨ç¤ºã€Œæ²¿ç”¨é»˜è®¤çš„æºç ç­‰è¾“å…¥ã€ï¼Œåœ¨æ­¤åŸºç¡€ä¸Šè¿½åŠ  `.env` å’Œ `.env.*`ã€‚  
è¿™æ ·æ”¹åŠ¨äº† `.env`ï¼Œbuild çš„ç¼“å­˜ä¼šå¤±æ•ˆï¼Œé‡æ–° buildã€‚

### envï¼šå“ªäº›ç¯å¢ƒå˜é‡å‚ä¸ã€Œç®—ç¼“å­˜ã€

å’Œ `inputs` ç±»ä¼¼ï¼šå¦‚æœæŸä¸ªç¯å¢ƒå˜é‡ä¼šå½±å“æ„å»ºç»“æœï¼ˆæ¯”å¦‚ `API_URL` æ‰“è¿›å‰ç«¯åŒ…ï¼‰ï¼Œå¿…é¡»å†™åœ¨ `env` é‡Œï¼Œå¦åˆ™æ”¹äº†è¿™ä¸ªå˜é‡ï¼ŒTurbo è¿˜ä¼šç”¨æ—§ç¼“å­˜ã€‚

```json
"build": {
  "outputs": ["dist/**"],
  "env": ["API_URL", "NODE_ENV"]
}
```

åªæœ‰åˆ—åœ¨ `env` é‡Œçš„å˜é‡å˜åŒ–ï¼Œæ‰ä¼šè®©è¯¥ä»»åŠ¡çš„ç¼“å­˜å¤±æ•ˆã€‚  
å¦‚æœå¾ˆå¤šä»»åŠ¡éƒ½ç”¨åŒä¸€æ‰¹å˜é‡ï¼Œå¯ä»¥ç”¨æ ¹çº§ **`globalEnv`**ï¼Œæ‰€æœ‰ä»»åŠ¡éƒ½ä¼šå¸¦ä¸Šè¿™äº›å˜é‡å‚ä¸å“ˆå¸Œã€‚

### cacheï¼šè¿™ä¸ªä»»åŠ¡è¦ä¸è¦ç¼“å­˜

- **true**ï¼ˆé»˜è®¤ï¼‰ï¼šæ ¹æ®è¾“å…¥ + env ç®—å“ˆå¸Œï¼Œå‘½ä¸­åˆ™å¤ç”¨è¾“å‡ºã€‚  
- **false**ï¼šæ¯æ¬¡éƒ½æ‰§è¡Œï¼Œä¸è¯»ä¹Ÿä¸å†™ç¼“å­˜ã€‚  
åƒ **dev** è¿™ç§æœ¬åœ°å¼€å‘æœåŠ¡ï¼Œä¸€èˆ¬è®¾æˆ **false**ï¼Œå› ä¸ºä½ è¦çš„æ˜¯ã€Œå®æ—¶è·‘ã€ï¼Œè€Œä¸æ˜¯å¤ç”¨ä¸Šæ¬¡çš„è¿›ç¨‹ã€‚

### persistentï¼šæ˜¯ä¸æ˜¯ã€Œä¸€ç›´è·‘ç€ã€çš„ä»»åŠ¡

- **true**ï¼šè¡¨ç¤ºè¿™ä¸ªä»»åŠ¡ä¼šé•¿æ—¶é—´è¿è¡Œï¼ˆä¾‹å¦‚ dev serverï¼‰ï¼Œä¸ä¼šè‡ªå·±é€€å‡ºã€‚Turbo ä¼šæŠŠå®ƒå½“å¸¸é©»è¿›ç¨‹ç®¡ç†ã€‚  
- **false**ï¼ˆé»˜è®¤ï¼‰ï¼šä»»åŠ¡è·‘å®Œå°±ç»“æŸï¼Œä¾‹å¦‚ buildã€lintã€testã€‚

**dev** é€šå¸¸é…æˆï¼š`"cache": false, "persistent": true`ã€‚

### globalEnv / globalDependencies

- **globalEnv**ï¼šåˆ—å‡ºã€Œå¯¹æ‰€æœ‰ä»»åŠ¡éƒ½å‚ä¸å“ˆå¸Œã€çš„ç¯å¢ƒå˜é‡ï¼Œä¸ç”¨åœ¨æ¯ä¸ª task é‡Œé‡å¤å†™ã€‚  
- **globalDependencies**ï¼šåˆ—å‡ºã€Œå¯¹æ‰€æœ‰ä»»åŠ¡éƒ½å‚ä¸å“ˆå¸Œã€çš„æ–‡ä»¶ï¼ˆå¦‚æ ¹ç›®å½•æŸé…ç½®æ–‡ä»¶ï¼‰ï¼Œè¿™äº›æ–‡ä»¶å˜äº†ï¼Œæ‰€æœ‰ä»»åŠ¡ç¼“å­˜éƒ½ä¼šå¤±æ•ˆã€‚  
ç”¨çš„æ—¶å€™è¦å…‹åˆ¶ï¼šåªæ”¾**çœŸçš„å½±å“å…¨ä»“åº“**çš„å˜é‡æˆ–æ–‡ä»¶ï¼Œå¦åˆ™ç¼“å­˜å¾ˆå®¹æ˜“å¤±æ•ˆã€‚

---

## dependsOn è¯¦è§£ï¼šè°å…ˆè·‘ã€è°åè·‘

ç”¨ä¾èµ–å…³ç³»å›¾ç†è§£ä¼šæœ€ç›´è§‚ã€‚

### å‡è®¾ä¾èµ–å…³ç³»

- `apps/web` ä¾èµ– `packages/ui` å’Œ `packages/utils`  
- `apps/api` ä¾èµ– `packages/utils`  
- `packages/ui` å’Œ `packages/utils` ä¹‹é—´æ²¡æœ‰ä¾èµ–  

å³ï¼š  
`web` â†’ `ui`ã€`utils`  
`api` â†’ `utils`

### å½“ä½ åœ¨æ ¹ç›®å½•æ‰§è¡Œ `turbo run build` ä¸”é…ç½®äº† `dependsOn: ["^build"]`

1. Turbo å…ˆçœ‹è°**æ²¡æœ‰**ä¾èµ–åˆ«çš„ workspace åŒ…ï¼š`packages/ui`ã€`packages/utils`ã€‚  
   â†’ å®ƒä¿©çš„ `build` **å¯ä»¥ä¸€èµ·è·‘**ï¼ˆå¹¶è¡Œï¼‰ã€‚  
2. ç­‰ `ui` å’Œ `utils` éƒ½ build å®Œåï¼Œå†è·‘ä¾èµ–å®ƒä»¬çš„åŒ…ï¼š  
   - `apps/web` ä¾èµ– `ui` å’Œ `utils`ï¼Œæ‰€ä»¥ä¼šç­‰ä¸¤ä¸ªéƒ½å®Œæˆåå† buildï¼›  
   - `apps/api` åªä¾èµ– `utils`ï¼Œæ‰€ä»¥ç­‰ `utils` å®Œæˆå°±å¯ä»¥ buildã€‚  
   `web` å’Œ `api` ä¹‹é—´æ²¡æœ‰ä¾èµ–ï¼Œæ‰€ä»¥**å¯ä»¥å¹¶è¡Œ**ã€‚  
3. æ€»ç»“é¡ºåºï¼š  
   - ç¬¬ä¸€è½®ï¼š`ui`ã€`utils` å¹¶è¡Œï¼›  
   - ç¬¬äºŒè½®ï¼š`web`ã€`api` å¹¶è¡Œã€‚

è¿™å°±æ˜¯ã€ŒæŒ‰ä¾èµ–å›¾æ’åº + èƒ½å¹¶è¡Œå°±å¹¶è¡Œã€ã€‚  
å¦‚æœä½ æ‰‹å†™ `cd` å’Œ `&&`ï¼Œè¦ä¹ˆé¡ºåºå®¹æ˜“é”™ï¼Œè¦ä¹ˆå…¨ä¸²è¡Œï¼Œå¾ˆæ…¢ã€‚

### ^build å’Œ build çš„åŒºåˆ«ï¼ˆå†å¼ºè°ƒä¸€éï¼‰

- **`^build`**ï¼š**åˆ«çš„åŒ…**ï¼ˆæˆ‘ä¾èµ–çš„åŒ…ï¼‰çš„ `build` è¦å…ˆè·‘å®Œã€‚  
- **`build`**ï¼ˆæ²¡æœ‰ ^ï¼‰ï¼š**æœ¬åŒ…**çš„ `build` è¦å…ˆè·‘å®Œã€‚  

ä¾‹å¦‚ï¼š

```json
"test": { "dependsOn": ["build"] }
```

è¡¨ç¤ºï¼šæ¯ä¸ªåŒ…éƒ½æ˜¯ã€Œå…ˆè·‘è‡ªå·±è¿™ä¸ªåŒ…çš„ buildï¼Œå†è·‘è‡ªå·±çš„ testã€ã€‚  
ä¸ä¼šå»è·‘å…¶ä»–åŒ…çš„ buildï¼Œåªä¿è¯æœ¬åŒ… test å‰æœ¬åŒ…å·²ç» build è¿‡ã€‚

### æŒ‡å®šã€ŒæŸä¸ªåŒ…ã€çš„ä»»åŠ¡ï¼špackage#task

ä¾‹å¦‚ä½ æœ‰ä¸€ä¸ªåªåœ¨æ ¹ç›®å½•è·‘çš„ã€Œéƒ¨ç½²ã€è„šæœ¬ï¼Œå¸Œæœ›å®ƒå…ˆç­‰ `web` çš„ build å®Œæˆï¼š

```json
"deploy": {
  "dependsOn": ["web#build"]
}
```

è¿™æ · `deploy` ä¼šç­‰åä¸º `web` çš„åŒ…çš„ `build` å®Œæˆåå†æ‰§è¡Œã€‚  
è¿™ç§ç”¨æ³•ç›¸å¯¹å°‘ï¼ŒçŸ¥é“æœ‰å³å¯ã€‚

---

## è¿è¡Œå‘½ä»¤ä¸è¿‡æ»¤ï¼šåªè·‘æˆ‘æƒ³è·‘çš„é‚£éƒ¨åˆ†

### åŸºæœ¬ç”¨æ³•

åœ¨æ ¹ç›®å½•ï¼ˆæˆ–ä»»æ„åŒ…å†…ï¼‰æ‰§è¡Œï¼š

```bash
turbo run build
turbo run lint
turbo run test
```

ä¼šæŒ‰ç…§ `turbo.json` çš„é…ç½®ï¼Œåœ¨æ‰€æœ‰**æœ‰å¯¹åº” script** çš„åŒ…é‡Œæ‰§è¡Œï¼Œå¹¶éµå®ˆä¾èµ–é¡ºåºå’Œç¼“å­˜ã€‚

å†æ¬¡æé†’ï¼š**å†™åœ¨ package.json æˆ– CI é‡Œæ—¶ï¼Œè¯·ç”¨ `turbo run build`**ï¼Œä¸è¦ç”¨ `turbo build`ã€‚

### åªè·‘æŸä¸€ä¸ªæˆ–æŸä¸€ç±»åŒ…ï¼š--filter

æœ‰æ—¶ä½ åªæ”¹äº†ä¸€ä¸ªåº”ç”¨ï¼Œåªæƒ³è·‘è¿™ä¸ªåº”ç”¨çš„ buildï¼š

```bash
# æŒ‰åŒ…åï¼ˆpackage.json çš„ nameï¼‰
turbo run build --filter=@repo/web

# æŒ‰ç›®å½•ï¼šåªè·‘ apps ä¸‹é¢çš„åŒ…
turbo run build --filter=./apps/*

# åªè·‘ web è¿™ä¸ªåŒ…
turbo run build --filter=web
```

**åŒ…å«ä¾èµ–å…³ç³»æ—¶**ï¼š

- `--filter=web...`ï¼šweb ä»¥åŠå®ƒ**ä¾èµ–**çš„åŒ…ï¼ˆä¼šå…ˆ build utilsã€ui å† build webï¼‰ã€‚  
- `--filter=...web`ï¼šweb ä»¥åŠ**ä¾èµ–å®ƒçš„**åŒ…ï¼ˆä¼š build web å† build ä¾èµ– web çš„åŒ…ï¼‰ã€‚

é€‚åˆã€Œæˆ‘åªæ”¹äº†ä¸€ä¸ª appï¼Œæƒ³è¿å¸¦å®ƒçš„ä¾èµ–ä¸€èµ· buildã€æˆ–ã€Œæˆ‘åªæƒ³éªŒè¯æŸä¸ªåŒ…åŠå…¶ä¸‹æ¸¸ã€ã€‚

### åªè·‘ã€Œæœ‰æ”¹åŠ¨çš„ã€åŒ…ï¼š--affected

åœ¨ CI æˆ–æ—¥å¸¸æƒ³çœæ—¶é—´æ—¶ï¼Œåªå¯¹ã€Œç›¸å¯¹æŸä¸ªåˆ†æ”¯æœ‰å˜æ›´ã€çš„åŒ…è·‘ä»»åŠ¡ï¼š

```bash
# ç›¸å¯¹é»˜è®¤åˆ†æ”¯ï¼ˆå¦‚ mainï¼‰æœ‰æ”¹åŠ¨çš„åŒ… + ä¾èµ–å®ƒä»¬çš„åŒ…
turbo run build --affected

# æŒ‡å®šå¯¹æ¯”çš„åˆ†æ”¯
turbo run build --affected --affected-base=origin/develop
```

Turbo ä¼šç»“åˆ Git  diff å’Œä¾èµ–å›¾ï¼Œåªè·‘å—å½±å“çš„åŒ…ï¼Œå…¶å®ƒåŒ…ç›´æ¥ç”¨ç¼“å­˜ï¼ˆè‹¥å‘½ä¸­ï¼‰ã€‚  
è¿™æ˜¯ CI é‡Œæœ€å¸¸ç”¨çš„ç”¨æ³•ä¹‹ä¸€ã€‚

### å°ç»“ï¼šä»€ä¹ˆæ—¶å€™ç”¨å“ªä¸ªï¼Ÿ

- **å…¨é‡**ï¼š`turbo run build`ï¼ˆä¸å†™ filterï¼‰ã€‚  
- **åªè·‘æŸä¸ªåŒ…/æŸç›®å½•**ï¼š`--filter=web` æˆ– `--filter=./apps/*`ã€‚  
- **è¦å¸¦ä¾èµ–/è¢«ä¾èµ–**ï¼š`--filter=web...` æˆ– `--filter=...web`ã€‚  
- **åªè·‘æ”¹åŠ¨çš„**ï¼š`--affected`ï¼ˆå¯åŠ  `--affected-base`ï¼‰ã€‚

---

## ç¼“å­˜ä¸ç¯å¢ƒå˜é‡ï¼šä¸ºä»€ä¹ˆæ”¹äº†ä»£ç è¿˜æ˜¯ç”¨æ—§ç»“æœ

### ç¼“å­˜æ˜¯æ€ä¹ˆç®—çš„ï¼Ÿ

Turbo å¯¹ã€Œæ¯ä¸ªåŒ…çš„æ¯ä¸ªä»»åŠ¡ã€ä¼šç®—ä¸€ä¸ª**å“ˆå¸Œ**ï¼Œè¾“å…¥åŒ…æ‹¬ï¼ˆç®€åŒ–ç†è§£ï¼‰ï¼š

- è¯¥åŒ…çš„æºç ã€é…ç½®æ–‡ä»¶ï¼ˆæˆ–ä½ åœ¨ `inputs` é‡Œå£°æ˜çš„ï¼‰  
- è¯¥ä»»åŠ¡ä¾èµ–çš„ä¸Šæ¸¸ä»»åŠ¡çš„**è¾“å‡º**ï¼ˆè‹¥é…ç½®äº† `dependsOn: ["^build"]`ï¼‰  
- è¯¥ä»»åŠ¡å£°æ˜çš„ **env** é‡Œçš„ç¯å¢ƒå˜é‡  
- å…¨å±€çš„ **globalDependencies** / **globalEnv**ï¼ˆè‹¥æœ‰ï¼‰

**å“ˆå¸Œç›¸åŒ** â†’ è®¤ä¸ºã€Œå’Œä¸Šæ¬¡ä¸€æ ·ã€â†’ ç›´æ¥ç”¨ä¸Šæ¬¡çš„ç¼“å­˜ï¼Œ**ä¸é‡æ–°æ‰§è¡Œ**ï¼Œåªä»ç¼“å­˜é‡Œè§£å‹ `outputs`ã€‚  
**å“ˆå¸Œä¸åŒ** â†’ é‡æ–°æ‰§è¡Œï¼Œå¹¶æŠŠæ–°çš„ `outputs` å†™å…¥ç¼“å­˜ã€‚

æ‰€ä»¥ï¼š  
å¦‚æœä½ **æ”¹äº†ä»£ç **ä½†æ²¡æ¸…ç¼“å­˜ï¼Œç†è®ºä¸Šå“ˆå¸Œä¼šå˜ï¼Œä¼šé‡æ–°è·‘ã€‚  
å¦‚æœä½ **æ”¹äº†ç¯å¢ƒå˜é‡æˆ– .env** ä½†æ²¡åœ¨ `env` / `inputs` é‡Œå£°æ˜ï¼Œå“ˆå¸Œä¸ä¼šå˜ï¼Œå°±ä¼šç»§ç»­ç”¨æ—§ç»“æœï¼Œçœ‹èµ·æ¥åƒã€Œæ”¹äº†å´ä¸ç”Ÿæ•ˆã€ã€‚

### ç¯å¢ƒå˜é‡ï¼šä¸€å®šè¦åœ¨ env é‡Œå£°æ˜

åªè¦æ„å»ºç»“æœå’ŒæŸä¸ªç¯å¢ƒå˜é‡æœ‰å…³ï¼ˆæ¯”å¦‚å‰ç«¯æ‰“åŒ…è¿›äº† `API_URL`ï¼‰ï¼Œå°±å¿…é¡»åœ¨å¯¹åº”ä»»åŠ¡çš„ **env** é‡Œå†™ä¸Šï¼š

```json
"build": {
  "outputs": ["dist/**"],
  "env": ["API_URL", "DATABASE_URL"]
}
```

å¦åˆ™æ”¹ `API_URL` å† buildï¼Œå¯èƒ½è¿˜æ˜¯æ—§çš„ API åœ°å€ã€‚

è‹¥å¾ˆå¤šä»»åŠ¡ç”¨åŒä¸€æ‰¹å˜é‡ï¼Œå¯åœ¨æ ¹çº§å†™ï¼š

```json
"globalEnv": ["NODE_ENV", "CI"],
"tasks": { ... }
```

### .env æ–‡ä»¶ï¼šè¦æ”¾è¿› inputs

Turbo **ä¸ä¼š**è‡ªåŠ¨åŠ è½½ `.env`ï¼ˆåŠ è½½æ˜¯ Next/Vite ç­‰æ¡†æ¶çš„äº‹ï¼‰ï¼Œä½†å®ƒéœ€è¦çŸ¥é“ã€Œ`.env` å˜äº†ï¼Œè¿™æ¬¡ build ä¸èƒ½å†ç”¨ç¼“å­˜ã€ï¼Œæ‰€ä»¥è¦æŠŠ `.env` æ”¾è¿› **inputs**ï¼š

```json
"build": {
  "outputs": ["dist/**"],
  "env": ["API_URL"],
  "inputs": ["$TURBO_DEFAULT$", ".env", ".env.*"]
}
```

`$TURBO_DEFAULT$` è¡¨ç¤ºä¿ç•™é»˜è®¤çš„æºç ç­‰è¾“å…¥ï¼Œåœ¨æ­¤åŸºç¡€ä¸ŠåŠ ä¸Š `.env` å’Œ `.env.*`ã€‚

### ä¸å»ºè®®æ ¹ç›®å½•ä¸€ä¸ª .env ç»™å…¨ä»“åº“ç”¨

æ ¹ç›®å½•æ”¾ä¸€ä¸ª `.env`ï¼Œæ‰€æœ‰åŒ…éƒ½èƒ½è¯»åˆ°ï¼Œä½†ä¼šæœ‰è¿™äº›é—®é¢˜ï¼š

- ä¸æ¸…æ¥šã€Œå“ªä¸ªåŒ…ç”¨äº†å“ªä¸ªå˜é‡ã€ï¼Œéš¾ç»´æŠ¤ã€‚  
- ç¼“å­˜å¤±æ•ˆèŒƒå›´å¤§ï¼šæ”¹ä¸€ä¸ªå˜é‡ï¼Œå¯èƒ½è®©å…¨ä»“åº“ä»»åŠ¡ç¼“å­˜éƒ½å¤±æ•ˆã€‚  
- å®¹æ˜“è¯¯æŠŠæ•æ„Ÿå˜é‡æš´éœ²ç»™ä¸éœ€è¦çš„åŒ…ã€‚

æ›´æ¨èï¼š**æ¯ä¸ªéœ€è¦ç¯å¢ƒå˜é‡çš„åº”ç”¨/åŒ…ï¼Œåœ¨è‡ªå·±ç›®å½•ä¸‹æ”¾ `.env`**ï¼Œå¹¶åœ¨è¯¥åŒ…å¯¹åº”çš„ä»»åŠ¡é‡Œç”¨ **env** + **inputs** å£°æ˜ã€‚

---

## CI/CD ä¸å¼€å‘æ—¶çš„ watch

### CI é‡Œæ€ä¹ˆç”¨

- **åªè·‘å—å½±å“çš„**ï¼š`turbo run build --affected`ï¼ˆä»¥åŠ `lint`ã€`test` ç­‰ï¼‰ï¼Œé…åˆ Git é»˜è®¤åˆ†æ”¯æˆ– `--affected-base`ã€‚  
- **è¿œç¨‹ç¼“å­˜**ï¼šå¯ä»¥æ¥ Vercel Remote Cache æˆ–è‡ªå»ºï¼Œè®© CI å‘½ä¸­ä½ æˆ–åŒäº‹æœ¬åœ°çš„ç¼“å­˜ï¼Œè¿›ä¸€æ­¥åŠ é€Ÿã€‚  
- **å•åº”ç”¨éƒ¨ç½²**ï¼ˆå¦‚ Vercel åªéƒ¨ç½² webï¼‰ï¼šå¯ç”¨ `turbo-ignore` ç­‰æœºåˆ¶ï¼Œåœ¨ã€Œå’Œè¯¥åº”ç”¨æ— å…³çš„æ”¹åŠ¨ã€æ—¶è·³è¿‡æ„å»ºã€‚

å…·ä½“æ­¥éª¤è§å®˜æ–¹æ–‡æ¡£çš„ [CI](https://turbo.build/repo/docs/ci)ï¼ˆå¦‚ GitHub Actions ç¤ºä¾‹ï¼‰ã€‚

### å¼€å‘æ—¶ï¼šturbo watch

æœ¬åœ°å¸Œæœ›ã€Œæ”¹ä¾èµ–åŒ…çš„æºç åï¼Œä¾èµ–å®ƒçš„åº”ç”¨èƒ½è‡ªåŠ¨é‡æ–° build æˆ–é‡å¯ã€ï¼š

```bash
turbo watch dev
```

è¦æ±‚ï¼š

- `turbo.json` é‡Œ `dev` é…å¥½ `cache: false`ã€`persistent: true`ã€‚  
- è‹¥éœ€è¦ã€Œå…ˆèµ·ä¾èµ–åŒ…çš„ dev å†èµ·åº”ç”¨çš„ devã€ï¼Œå¯ç”¨ `dependsOn: ["^dev"]` ç­‰ï¼Œè¯¦è§å®˜æ–¹ [Watch](https://turbo.build/repo/docs/reference/configuration#watch-mode)ã€‚

---

## å¸¸è§å‘ä¸æ­£ç¡®å†™æ³•

| å‘ | ä¸ºå•¥é”™ | æ­£ç¡®å†™æ³• |
|----|--------|----------|
| æ ¹è„šæœ¬å†™ `turbo build` | ç®€å†™ä¸é€‚åˆå†™åœ¨è„šæœ¬é‡Œï¼Œå»ºè®®ç»Ÿä¸€ç”¨ `turbo run` | å†™ `turbo run build` |
| æ ¹è„šæœ¬è‡ªå·±å†™ `cd apps/web && pnpm build` | ç»•è¿‡ Turboï¼Œæ— å¹¶è¡Œã€æ— ç¼“å­˜ã€éš¾ç»´æŠ¤ | æ ¹åªå†™ `turbo run build`ï¼Œå„åŒ…è‡ªå·±å†™ `build` |
| ä¸å†™ `outputs` | ç¼“å­˜å‘½ä¸­ä½†ä¸ä¼šæ¢å¤ dist/.nextï¼Œå¯èƒ½ç”¨æ—§äº§ç‰©æˆ–æŠ¥é”™ | build ç­‰æœ‰äº§å‡ºçš„ä»»åŠ¡éƒ½å†™ä¸Š `outputs` |
| ææ·· `^build` å’Œ `build` | é¡ºåºä¼šä¹± | `^build` = ä¾èµ–åŒ…çš„ buildï¼›`build` = æœ¬åŒ…çš„ build |
| ç”¨ prebuild é‡Œ cd åˆ°ä¾èµ–åŒ… build | Turbo ä¸çŸ¥é“ä¾èµ–ï¼Œé¡ºåºéš¾ç»´æŠ¤ | åœ¨ dependencies é‡Œå£°æ˜ workspace åŒ…ï¼Œç”¨ `dependsOn: ["^build"]` |
| æ”¹äº†ç¯å¢ƒå˜é‡ / .env ä½†ç¼“å­˜æ²¡å¤±æ•ˆ | æ²¡åœ¨ env/inputs é‡Œå£°æ˜ | åœ¨å¯¹åº”ä»»åŠ¡é‡Œå†™ `env` å’Œ `inputs` |
| æ ¹ç›®å½•ä¸€ä¸ª .env | è°ç”¨è°ä¸æ¸…æ¥šï¼Œç¼“å­˜å¤±æ•ˆèŒƒå›´å¤§ | å„åŒ…å„è‡ª .envï¼Œå¹¶åœ¨ä»»åŠ¡é‡Œå£°æ˜ |
| ç”¨ `--parallel` å¼ºè¡Œå…¨å¹¶è¡Œ | å¯èƒ½ç ´åä¾èµ–é¡ºåº | ç”¨ `dependsOn` è¡¨è¾¾é¡ºåºï¼Œè®© Turbo è‡ªç„¶å¹¶è¡Œ |
| åœ¨ inputs é‡Œå†™ `../shared/config.json` | è·¨åŒ…è·¯å¾„ä¸æ¨è | ç”¨ `$TURBO_ROOT$/shared/config.json` ç­‰æ ¹è·¯å¾„ |
| æ ¹ turbo.json é‡Œç»™æ¯ä¸ªåŒ…å†™ package#task | æ ¹é…ç½®ä¼šéå¸¸ä¹± | ç”¨å„åŒ…ä¸‹çš„ turbo.jsonï¼ˆPackage Configurationsï¼‰è¦†ç›– |

---

## ä¸€ä¸ªå®Œæ•´ç¤ºä¾‹ï¼šä»é›¶æ­ä¸€ä¸ªå° monorepo

ä¸‹é¢ç”¨æœ€ç®€ç»“æ„èµ°ä¸€éï¼šä¸€ä¸ªå‰ç«¯ appã€ä¸€ä¸ªå…¬å…±åŒ…ã€æ ¹ç”¨ Turbo ç¼–æ’ã€‚

### 1. ç›®å½•ç»“æ„

```
my-turbo/
â”œâ”€â”€ apps/
â”‚   â””â”€â”€ web/
â”‚       â”œâ”€â”€ package.json
â”‚       â””â”€â”€ next.config.js
â”œâ”€â”€ packages/
â”‚   â””â”€â”€ ui/
â”‚       â”œâ”€â”€ package.json
â”‚       â””â”€â”€ tsconfig.json
â”œâ”€â”€ package.json
â”œâ”€â”€ pnpm-workspace.yaml
â””â”€â”€ turbo.json
```

### 2. æ ¹ package.json

```json
{
  "name": "my-turbo",
  "private": true,
  "scripts": {
    "build": "turbo run build",
    "dev": "turbo run dev"
  },
  "devDependencies": {
    "turbo": "latest"
  }
}
```

### 3. pnpm-workspace.yamlï¼ˆå£°æ˜å“ªäº›ç›®å½•æ˜¯åŒ…ï¼‰

```yaml
packages:
  - "apps/*"
  - "packages/*"
```

### 4. æ ¹ turbo.json

```json
{
  "$schema": "https://turborepo.dev/schema.v2.json",
  "tasks": {
    "build": {
      "dependsOn": ["^build"],
      "outputs": [".next/**", "!.next/cache/**", "dist/**"]
    },
    "dev": {
      "cache": false,
      "persistent": true
    }
  }
}
```

### 5. packages/ui/package.jsonï¼ˆå…¬å…±åŒ…ï¼‰

```json
{
  "name": "@repo/ui",
  "version": "0.0.0",
  "main": "dist/index.js",
  "scripts": {
    "build": "tsc",
    "dev": "tsc --watch"
  },
  "devDependencies": {
    "typescript": "^5.0.0"
  }
}
```

### 6. apps/web/package.jsonï¼ˆåº”ç”¨ï¼Œä¾èµ– @repo/uiï¼‰

```json
{
  "name": "web",
  "version": "0.0.0",
  "scripts": {
    "build": "next build",
    "dev": "next dev"
  },
  "dependencies": {
    "@repo/ui": "workspace:*"
  },
  "devDependencies": {
    "next": "^14.0.0",
    "react": "^18.0.0"
  }
}
```

æ³¨æ„ï¼š**å¿…é¡»**åœ¨ `dependencies` é‡Œå†™ `@repo/ui`ï¼Œè¿™æ · Turbo æ‰çŸ¥é“ `web` ä¾èµ– `ui`ï¼Œæ‰ä¼šå…ˆè·‘ `ui` çš„ build å†è·‘ `web` çš„ buildã€‚

### 7. å®‰è£…ä¾èµ–å¹¶è¿è¡Œ

åœ¨æ ¹ç›®å½•ï¼š

```bash
pnpm install
pnpm build
```

ä½ ä¼šçœ‹åˆ°ï¼šå…ˆ build `packages/ui`ï¼Œå† build `apps/web`ã€‚å†æ‰§è¡Œä¸€æ¬¡ `pnpm build`ï¼Œè‹¥æ²¡æ”¹ä»£ç ï¼Œä¼šç›´æ¥å‘½ä¸­ç¼“å­˜ã€‚  
æ”¹ä¸€ä¸‹ `packages/ui` çš„æºç å† `pnpm build`ï¼Œåªæœ‰ `ui` å’Œ `web` ä¼šé‡æ–°æ‰§è¡Œï¼Œä¸”é¡ºåºä»ç„¶æ­£ç¡®ã€‚

---

## æœ€ä½³å®è·µä¸å‚è€ƒ

1. **ä»»åŠ¡åœ¨å„åŒ…ã€æ ¹åªå‘å·æ–½ä»¤**ï¼šå…·ä½“å‘½ä»¤å†™åœ¨å„åŒ… `package.json`ï¼Œæ ¹åªå†™ `turbo run <task>`ã€‚  
2. **è„šæœ¬é‡Œç»Ÿä¸€ç”¨ `turbo run`**ï¼šä¸åœ¨ package.json / CI é‡Œå†™ `turbo build` ç®€å†™ã€‚  
3. **æœ‰äº§å‡ºå°±é… outputs**ï¼šbuildã€ç”Ÿæˆ coverage ç­‰ä¼šå†™æ–‡ä»¶çš„ä»»åŠ¡ï¼Œéƒ½å†™ä¸Š `outputs`ã€‚  
4. **ä¾èµ–å…³ç³»ç”¨ workspace å£°æ˜**ï¼šåŒ…ä¹‹é—´ç”¨ `workspace:*` å¼•ç”¨ï¼Œç”¨ `dependsOn: ["^build"]` æ§åˆ¶é¡ºåºï¼Œä¸è¦æ‰‹å†™ prebuild/cdã€‚  
5. **ç¯å¢ƒå˜é‡å’Œ .env æ˜¾å¼å‚ä¸ç¼“å­˜**ï¼šå½±å“ç»“æœçš„å°±å†™è¿› `env` å’Œ `inputs`ã€‚  
6. **CI ç”¨ --affected**ï¼šåªè·‘å—å½±å“åŒ…ï¼ŒèŠ‚çœæ—¶é—´ã€‚  
7. **åŒ…ä¹‹é—´é…ç½®ä¸åŒæ—¶ç”¨åŒ…çº§ turbo.json**ï¼šæ ¹ä¿æŒé€šç”¨ï¼Œå·®å¼‚å†™åœ¨å„åŒ…çš„ `turbo.json` é‡Œ `extends: ["//"]` å†è¦†ç›–ã€‚

### å‚è€ƒé“¾æ¥

- [Turborepo å®˜æ–¹æ–‡æ¡£](https://turbo.build/repo/docs)
- [ä»»åŠ¡é…ç½® (tasks)](https://turbo.build/repo/docs/reference/configuration#tasks)
- [è¿‡æ»¤ (--filter, --affected)](https://turbo.build/repo/docs/reference/command-line-reference#--filter)
- [ç¯å¢ƒå˜é‡](https://turbo.build/repo/docs/reference/configuration#env)
- [CI (GitHub Actions ç­‰)](https://turbo.build/repo/docs/ci)
- [Package Configurations](https://turbo.build/repo/docs/reference/configuration#package-configurations)
